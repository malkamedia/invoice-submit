<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vendor Invoice Form - Malka Media Group</title>
    
    <style>
        /* Invoice Form Styles - Complete Fix */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        :root {
            --color-primary: #2563eb;
            --color-primary-light: #3b82f6;
            --color-success: #059669;
            --color-danger: #dc2626;
            --color-gray-50: #f9fafb;
            --color-gray-100: #f3f4f6;
            --color-gray-200: #e5e7eb;
            --color-gray-300: #d1d5db;
            --color-gray-400: #9ca3af;
            --color-gray-500: #6b7280;
            --color-gray-600: #4b5563;
            --color-gray-700: #374151;
            --color-gray-800: #1f2937;
            --color-gray-900: #111827;
            --font-size-xs: 0.7rem;
            --font-size-sm: 0.8rem;
            --font-size-base: 0.875rem;
            --font-size-lg: 1rem;
            --font-size-xl: 1.125rem;
            --font-size-2xl: 1.25rem;
            --font-size-3xl: 1.5rem;
            --space-1: 0.25rem;
            --space-2: 0.375rem;
            --space-3: 0.5rem;
            --space-4: 0.75rem;
            --space-5: 1rem;
            --space-6: 1.25rem;
            --space-8: 1.5rem;
            --border-radius-sm: 0.25rem;
            --border-radius: 0.375rem;
            --border-radius-lg: 0.5rem;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --z-dropdown: 1000;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            font-size: var(--font-size-base);
            line-height: 1.4;
            color: var(--color-gray-800);
            background: var(--color-gray-50);
            padding: var(--space-4);
        }

        .invoice-container {
            max-width: 56rem;
            margin: 0 auto;
            background: white;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow);
            border: 1px solid var(--color-gray-200);
            position: relative;
        }

        .invoice-header {
            background: white;
            padding: var(--space-6) var(--space-6) var(--space-4);
            border-bottom: 1px solid var(--color-gray-200);
        }

        .header-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-6);
            align-items: start;
        }

        .invoice-title h1 {
            font-size: var(--font-size-2xl);
            font-weight: 700;
            color: var(--color-gray-900);
            margin-bottom: var(--space-1);
            letter-spacing: -0.025em;
        }

        .invoice-title p {
            font-size: var(--font-size-sm);
            color: var(--color-gray-500);
        }

        .vendor-info {
            text-align: right;
        }

        .vendor-info h3 {
            font-size: var(--font-size-xs);
            font-weight: 600;
            color: var(--color-gray-700);
            margin-bottom: var(--space-3);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .vendor-fields {
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
        }

        .form-section {
            padding: var(--space-5) var(--space-6);
            border-bottom: 1px solid var(--color-gray-100);
        }

        .form-section:last-child {
            border-bottom: none;
        }

        .section-title {
            font-size: var(--font-size-lg);
            font-weight: 600;
            color: var(--color-gray-900);
            margin-bottom: var(--space-4);
            display: flex;
            align-items: center;
        }

        .required-field::after {
            content: '*';
            color: var(--color-danger);
            margin-left: var(--space-1);
            font-weight: 500;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-5);
        }

        .form-input, .table-input {
            width: 100%;
            padding: var(--space-2) var(--space-3);
            border: 1px solid var(--color-gray-300);
            border-radius: var(--border-radius);
            font-size: var(--font-size-sm);
            font-weight: 400;
            background: white;
            transition: all 0.2s ease;
            outline: none;
            color: var(--color-gray-800);
        }

        .form-input:focus, .table-input:focus {
            border-color: var(--color-primary);
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.1);
        }

        /* FIXED: Only apply dropdown arrow to actual select elements */
        select.form-select {
            width: 100%;
            padding: var(--space-2) var(--space-3);
            padding-right: 40px;
            border: 1px solid var(--color-gray-300);
            border-radius: var(--border-radius);
            font-size: var(--font-size-sm);
            font-weight: 400;
            background: white;
            color: var(--color-gray-800);
            cursor: pointer;
            outline: none;
            transition: all 0.2s ease;
            appearance: none;
            -webkit-appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 16px;
        }

        select.form-select:focus {
            border-color: var(--color-primary);
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.1);
        }

        /* FIXED: Tax input without dropdown styling */
        .tax-input {
            width: 60px !important;
            padding: var(--space-1) var(--space-2) !important;
            text-align: right;
            border: 1px solid var(--color-gray-300) !important;
            border-radius: var(--border-radius-sm) !important;
            font-size: var(--font-size-sm) !important;
            height: 28px !important;
            background: white !important;
            /* No dropdown arrow */
            appearance: textfield !important;
            -moz-appearance: textfield !important;
        }

        .tax-input::-webkit-inner-spin-button,
        .tax-input::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .bill-to-section {
            background: var(--color-gray-50);
            padding: var(--space-3);
            border-radius: var(--border-radius);
            border: 1px solid var(--color-gray-200);
        }

        .bill-to-section .section-title {
            margin-bottom: var(--space-2);
            font-size: var(--font-size-base);
        }

        .bill-to-fields {
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
            margin-bottom: var(--space-3);
        }

        .cost-center-field {
            padding-top: var(--space-3);
            border-top: 1px solid var(--color-gray-200);
        }

        .cost-center-field label {
            display: block;
            margin-bottom: var(--space-1);
            font-size: var(--font-size-xs);
            font-weight: 500;
            color: var(--color-gray-700);
        }

        .invoice-details {
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
        }

        .detail-row {
            display: grid;
            grid-template-columns: 120px 1fr;
            gap: var(--space-3);
            align-items: center;
        }

        .detail-label {
            font-weight: 500;
            color: var(--color-gray-700);
            font-size: var(--font-size-sm);
        }

        .detail-input {
            max-width: 200px;
        }

        .service-period-section {
            background: var(--color-gray-50);
            padding: var(--space-4);
            border-radius: var(--border-radius);
            border: 1px solid var(--color-gray-200);
        }

        .service-period-section .section-title {
            margin-bottom: var(--space-3);
            font-size: var(--font-size-base);
        }

        .service-period-section label {
            display: block;
            font-size: var(--font-size-sm);
            font-weight: 500;
            color: var(--color-gray-700);
            margin-bottom: var(--space-1);
        }

        .invoice-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            background: white;
            border: 1px solid var(--color-gray-200);
            border-radius: 0;
            margin-bottom: var(--space-4);
            box-shadow: var(--shadow-sm);
            font-size: var(--font-size-sm);
        }

        .table-header {
            background: var(--color-gray-50);
        }

        .table-header th {
            padding: var(--space-2) var(--space-3);
            font-weight: 600;
            font-size: var(--font-size-xs);
            text-align: left;
            color: var(--color-gray-700);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-bottom: 1px solid var(--color-gray-200);
        }

        .table-header th:nth-child(1) { width: 50%; min-width: 200px; }
        .table-header th:nth-child(2) { width: 15%; min-width: 80px; }
        .table-header th:nth-child(3) { width: 12%; min-width: 60px; }
        .table-header th:nth-child(4) { width: 12%; min-width: 60px; }
        .table-header th:nth-child(5) { width: 12%; min-width: 70px; }
        .table-header th:nth-child(6) { width: 8%; min-width: 60px; }

        .table-row {
            border-bottom: 1px solid var(--color-gray-100);
            transition: background-color 0.15s ease;
        }

        .table-row:hover {
            background: var(--color-gray-50);
        }

        .table-cell {
            padding: var(--space-2) var(--space-3);
            vertical-align: middle;
        }

        .table-input {
            padding: var(--space-1) var(--space-2);
            font-size: var(--font-size-sm);
            border: 1px solid var(--color-gray-300);
            height: 28px;
        }

        .amount-cell {
            font-weight: 600;
            color: var(--color-gray-800);
            text-align: right;
            font-variant-numeric: tabular-nums;
        }

        .job-code {
            text-align: center;
        }

        .quantity, .rate {
            text-align: right;
        }

        .action-buttons {
            display: flex;
            gap: var(--space-1);
            justify-content: center;
            align-items: center;
        }

        .action-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: var(--space-1);
            border: 1px solid;
            border-radius: var(--border-radius-sm);
            font-size: var(--font-size-xs);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 24px;
            height: 24px;
            outline: none;
        }

        .duplicate-btn {
            background: var(--color-gray-50);
            color: var(--color-gray-600);
            border-color: var(--color-gray-300);
        }

        .duplicate-btn:hover {
            background: var(--color-gray-100);
            border-color: var(--color-gray-400);
        }

        .remove-btn {
            background: #fef2f2;
            color: var(--color-danger);
            border-color: #fecaca;
        }

        .remove-btn:hover {
            background: #fee2e2;
            border-color: #fca5a5;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-2) var(--space-4);
            border: none;
            border-radius: var(--border-radius);
            font-weight: 500;
            font-size: var(--font-size-sm);
            cursor: pointer;
            transition: all 0.2s ease;
            outline: none;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-primary {
            background: var(--color-primary);
            color: white;
            border: 1px solid var(--color-primary);
        }

        .btn-primary:hover {
            background: var(--color-primary-light);
        }

        .btn-success {
            background: var(--color-success);
            color: white;
            border: 1px solid var(--color-success);
        }

        .add-item-btn {
            margin-top: var(--space-3);
        }

        .totals-section {
            display: flex;
            justify-content: flex-end;
            margin-top: var(--space-5);
        }

        .totals-container {
            background: var(--color-gray-50);
            padding: var(--space-4);
            border-radius: var(--border-radius);
            border: 1px solid var(--color-gray-200);
            min-width: 280px;
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-2);
        }

        .total-row:last-child {
            margin-bottom: 0;
            padding-top: var(--space-3);
            border-top: 2px solid var(--color-gray-300);
            margin-top: var(--space-3);
        }

        .total-label {
            font-weight: 500;
            font-size: var(--font-size-sm);
            color: var(--color-gray-700);
        }

        .total-value {
            font-weight: 600;
            font-size: var(--font-size-base);
            color: var(--color-gray-900);
            font-variant-numeric: tabular-nums;
        }

        .grand-total {
            font-size: var(--font-size-lg);
            font-weight: 700;
        }

        .invoice-footer {
            background: var(--color-gray-50);
            padding: var(--space-6);
            text-align: center;
            border-top: 1px solid var(--color-gray-200);
        }

        .footer-message {
            margin-bottom: var(--space-5);
        }

        .footer-message h3 {
            font-size: var(--font-size-lg);
            font-weight: 600;
            color: var(--color-gray-900);
            margin-bottom: var(--space-1);
        }

        .footer-message p {
            color: var(--color-gray-600);
            font-size: var(--font-size-sm);
        }

        .button-group {
            display: flex;
            justify-content: center;
            gap: var(--space-3);
            flex-wrap: wrap;
        }

        .status-message {
            margin-top: var(--space-4);
            padding: var(--space-3);
            border-radius: var(--border-radius);
            font-weight: 500;
            font-size: var(--font-size-sm);
            display: none;
            text-align: center;
        }

        .status-message.show {
            display: block;
        }

        .status-success {
            background: #ecfdf5;
            color: #065f46;
            border: 1px solid #10b981;
        }

        .status-error {
            background: #fef2f2;
            color: #991b1b;
            border: 1px solid #ef4444;
        }

        .validation-error {
            border-color: var(--color-danger) !important;
        }

        @media print {
            body {
                background: white;
                padding: 0;
            }
            
            .invoice-container {
                box-shadow: none;
                border: none;
            }
            
            .no-print {
                display: none !important;
            }
        }

        @media (max-width: 768px) {
            .header-content,
            .grid-2 {
                grid-template-columns: 1fr;
            }
            
            .vendor-info {
                text-align: left;
            }
            
            .button-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div id="invoice-form" class="invoice-container">
        
        <!-- Header Section -->
        <header class="invoice-header">
            <div class="header-content">
                <div class="invoice-title">
                    <h1>INVOICE</h1>
                    <p>Professional Services Invoice</p>
                </div>
                
                <div class="vendor-info">
                    <h3 class="required-field">Vendor Information</h3>
                    <div class="vendor-fields">
                        <input id="vendor-name" type="text" placeholder="Vendor Company Name" 
                               class="form-input" required>
                        <input id="vendor-address" type="text" placeholder="Vendor Address" 
                               class="form-input">
                        <input id="vendor-city" type="text" placeholder="City, State, ZIP" 
                               class="form-input">
                        <input id="vendor-email" type="email" placeholder="vendor.email@example.com" 
                               class="form-input" required>
                    </div>
                </div>
            </div>
        </header>

        <!-- Bill To & Invoice Details Section -->
        <section class="form-section">
            <div class="grid-2">
                <!-- Bill To -->
                <div class="bill-to-section">
                    <h2 class="section-title required-field">Bill To</h2>
                    <div class="bill-to-fields">
                        <input id="client-name" type="text" placeholder="Client Company Name" 
                               value="Malka Media Group" class="form-input" required>
                        <input id="hiring-manager" type="text" placeholder="Hiring Manager" 
                               class="form-input" required>
                        <input id="hiring-manager-email" type="email" placeholder="hiringmanager@malkamedia.com" 
                               class="form-input" required>
                    </div>
                    
                    <!-- Cost Center Dropdown -->
                    <div class="cost-center-field">
                        <label for="cost-center" class="detail-label required-field">Cost Center</label>
                        <select id="cost-center" class="form-select" required>
                            <option value="" disabled selected>Select Cost Center...</option>
                            <option value="40677">40677 - ML Malka Post Production</option>
                            <option value="40382">40382 - ML Malka Production</option>
                            <option value="40405">40405 - ML Malka Media Operations</option>
                            <option value="40383">40383 - ML Malka Project Management</option>
                            <option value="40425">40425 - ML Malka Animation</option>
                            <option value="40473">40473 - ML Malka Creative Services</option>
                            <option value="40386">40386 - ML Malka Account Management</option>
                        </select>
                    </div>
                </div>
                
                <!-- Invoice Details -->
                <div class="invoice-details">
                    <h2 class="section-title">Invoice Details</h2>
                    <div class="detail-row">
                        <label for="invoice-number" class="detail-label required-field">Invoice #</label>
                        <input type="text" id="invoice-number" placeholder="INV-12345" 
                               class="form-input detail-input" value="INV-001" required>
                    </div>
                    <div class="detail-row">
                        <label for="invoice-date" class="detail-label required-field">Invoice Date</label>
                        <input type="date" id="invoice-date" 
                               class="form-input detail-input" required>
                    </div>
                    <div class="detail-row">
                        <label for="pay-terms" class="detail-label required-field">Payment Terms</label>
                        <select id="pay-terms" class="form-select detail-input" required>
                            <option value="Due on Receipt">Due on Receipt</option>
                            <option value="Net 15">Net 15</option>
                            <option value="Net 30" selected>Net 30</option>
                            <option value="Net 45">Net 45</option>
                            <option value="Net 60">Net 60</option>
                        </select>
                    </div>
                    <div class="detail-row">
                        <label for="po-number" class="detail-label">PO# (Optional)</label>
                        <input type="text" id="po-number" placeholder="Enter PO Number" 
                               class="form-input detail-input">
                    </div>
                </div>
            </div>
        </section>

        <!-- Service Period Section -->
        <section class="form-section">
            <div class="service-period-section">
                <h2 class="section-title required-field">Service Period</h2>
                <div class="grid-2">
                    <div>
                        <label for="service-start" class="detail-label">Service Start Date</label>
                        <input type="date" id="service-start" 
                               class="form-input" required>
                    </div>
                    <div>
                        <label for="service-end" class="detail-label">Service End Date</label>
                        <input type="date" id="service-end" 
                               class="form-input" required>
                    </div>
                </div>
            </div>
        </section>

        <!-- Invoice Items Section -->
        <section class="form-section">
            <h2 class="section-title">Invoice Items</h2>
            <div class="table-wrapper">
                <table class="invoice-table">
                    <thead class="table-header">
                        <tr>
                            <th>Service / Item</th>
                            <th>Job Code</th>
                            <th>Hours/QTY</th>
                            <th>Rate</th>
                            <th>Amount</th>
                            <th class="no-print">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="invoice-items">
                        <!-- Items will be added here dynamically -->
                    </tbody>
                </table>
            </div>
            <button type="button" id="add-item-btn" class="btn btn-primary add-item-btn no-print">
                + Add Item
            </button>
        </section>

        <!-- Totals Section -->
        <section class="form-section">
            <div class="totals-section">
                <div class="totals-container">
                    <div class="total-row">
                        <span class="total-label">Subtotal:</span>
                        <span id="subtotal" class="total-value">$0.00</span>
                    </div>
                    <div class="total-row">
                        <label for="tax-rate" class="total-label">Tax (%):</label>
                        <input type="number" id="tax-rate" value="0" min="0" max="100" step="0.1" 
                               class="tax-input">
                    </div>
                    <div class="total-row">
                        <span class="total-label">Total:</span>
                        <span id="grand-total" class="total-value grand-total">$0.00</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer Section -->
        <footer class="invoice-footer no-print">
            <div class="footer-message">
                <h3>Thank you for your business!</h3>
                <p>Please ensure all required fields are completed before downloading or submitting.</p>
            </div>
            
            <div class="button-group">
                <button type="button" id="print-btn" class="btn btn-success">
                    Print / Save as PDF
                </button>
                <button type="button" id="submit-btn" class="btn btn-primary">
                    Submit to Spreadsheet
                </button>
            </div>
            
            <div id="status-message" class="status-message"></div>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const itemsContainer = document.getElementById('invoice-items');
            const addItemBtn = document.getElementById('add-item-btn');
            const subtotalEl = document.getElementById('subtotal');
            const taxRateEl = document.getElementById('tax-rate');
            const grandTotalEl = document.getElementById('grand-total');
            const submitBtn = document.getElementById('submit-btn');
            const printBtn = document.getElementById('print-btn');
            const statusMessage = document.getElementById('status-message');

            // Configuration
            const GOOGLE_SCRIPT_URL = 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE';

            // Service options
            const serviceOptions = [
                // Pre-Production Labor
                'A. Audio Mixer', 'A. Cam Operator', 'A. Director', 'A. Producer',
                'A. Producer - Associate Producer', 'A. Producer - Creative Producer', 
                'A. Producer - Executive Producer', 'A. Production Coordinator / PA',
                'A. Production Manager', 'A. Assistant Camera', 'A. Assistant Director',
                'A. Best Boy Electric', 'A. Gaffer', 'A. Best Boy Grip', 'A. Key Grip',
                'A. Director of Photography', 'A. Director of Photography - Commercial',
                'A. Director - Commercial', 'A. DIT', 'A. Hair & Makeup Artist', 'A. Jib',
                'A. Jib Assist', 'A. Live Audio Mixer', 'A. Livestream Graphic Tech',
                'A. Photographer', 'A. Photographer - Commercial', 'A. Producer - Field',
                'A. Production Designer', 'A. Production Sound Engineer', 'A. Script Supervisor',
                'A. Set Medic', 'A. Steadicam', 'A. Swing', 'A. Technical Director',
                'A. Teleprompter Operator', 'A. VTR Operator', 'A. 2nd Assistant Camera',
                'A. Electric', 'A. Grip', 'A. Hair and Makeup Assistant', 'A. Location Scout',
                'A. 2nd Assistant Director', 'A. Teamsters / Driver', 'A. Pre-Production Fringe',
                
                // Shoot Labor
                'B. Audio Mixer', 'B. Cam Operator', 'B. Director', 'B. Producer',
                'B. Producer - Associate Producer', 'B. Producer - Creative Producer',
                'B. Producer - Executive Producer', 'B. Production Coordinator / PA',
                'B. Production Manager', 'B. Assistant Camera', 'B. Assistant Director',
                'B. Best Boy Electric', 'B. Gaffer', 'B. Best Boy Grip', 'B. Key Grip',
                'B. Director of Photography', 'B. Director of Photography - Commercial',
                'B. Director - Commercial', 'B. DIT', 'B. Hair & Makeup Artist', 'B. Jib',
                'B. Jib Assist', 'B. Live Audio Mixer', 'B. Livestream Graphic Tech',
                'B. Photographer', 'B. Photographer - Commercial', 'B. Producer - Field',
                'B. Production Designer', 'B. Production Sound Engineer', 'B. Script Supervisor',
                'B. Set Medic', 'B. Steadicam', 'B. Swing', 'B. Technical Director',
                'B. Teleprompter Operator', 'B. VTR Operator', 'B. 2nd Assistant Camera',
                'B. Electric', 'B. Grip', 'B. Hair and Makeup Assistant', 'B. Location Scout',
                'B. 2nd Assistant Director', 'B. Teamsters / Driver', 'B. Shoot Fringe',
                
                // Prep & Wrap Expenses
                'C. Craft Services', 'C. Meals - Per Diem', 'C. Hotels', 'C. Taxi & Rideshare',
                'C. Car Rental', 'C. Casting Director',
                
                // Location Expenses
                'D. Location Rental', 'D. Drone Permit', 'D. Set Security',
                'D. Cargo Van / Production Trucking / Camera Truck', 'D. Car Rental',
                'D. Other Vehicles', 'D. Parking/Tolls/Gas', 'D. Baggage Fees', 'D. Airfare',
                'D. Hotel', 'D. Per Diems', 'D. Site Rep', 'D. Catering', 'D. Craft Services',
                'D. Taxi & Rideshare', 'D. Kit Rental',
                
                // Props and Wardrobe
                'E. Prop Rental', 'E. Prop Purchase', 'E. Prop Fabrication',
                'E. Wardrobe Rental', 'E. Wardrobe Purchase',
                
                // Studio Costs
                'F. Rental For Build Days', 'F. Build OT Hours', 'F. Rental for Pre-Light Days',
                'F. Pre-Light OT Hours', 'F. Rental for Shoot Days', 'F. Shoot OT Hours',
                'F. Rental For Strike Days', 'F. Strike OT Hours', 'F. Generator & Operator',
                'F. Stage Manager/Studio Security', 'F. Power Charges', 'F. Misc. Studio Charges',
                'F. Crew Parking', 'F. Condor/Scissor Lift', 'F. Steeldeck',
                
                // Art Department Labor
                'G. Production Designer', 'G. Art Department Coordinator', 'G. Prop Master',
                'G. Assistant Props', 'G. Swing', 'G. Leadperson', 'G. Set Designer',
                'G. Set Dresser', 'G. Wardrobe Stylist', 'G. Wardrobe Assistant',
                'G. Scenics', 'G. Grips / Riggers', 'G. Art Department Fringe',
                
                // Art Department Expenses
                'H. Set Dressing Rentals', 'H. Set Dressing Purchases', 'H. Art Department Prod Supplies',
                'H. Art Department Kit Rentals', 'H. Special Effects Rentals', 'H. Art Department Trucking',
                'H. Outside Construction', 'H. Car Prep', 'H. Art Department Meals',
                'H. Messengers/Deliveries',
                
                // Equipment Rentals
                'I. Camera Rental', 'I. Sound Rental', 'I. Lighting Rental', 'I. Grip Rental',
                'I. Generator Rental', 'I. Crane Rental', 'I. VTR Rental', 'I. Walkie Talkie Rental',
                'I. Dolly Rental', 'I. Helicopter', 'I. Production Supplies', 'I. Jib Arm',
                'I. Crane Head', 'I. Camera Accessories', 'I. Expendables', 'I. Lenses',
                'I. Cinedrives',
                
                // Media
                'J. Media / Drives', 'J. Film', 'J. Transcode / Transfer', 'J. Process', 'J. Dailies',
                
                // Miscellaneous Production Cost
                'K. Insurance', 'K. Misc Other Production Costs', 'K. Specialty Service',
                
                // Talent Expenses
                'L. Talent Fee', 'L. Talent Flights', 'L. Talent Hotels', 'L. Talent Meals',
                'L. Talent Manager', 'L. Other Talent Related Expenses', 'L. Agency Fees',
                
                // Post Production Labor
                'M. Editor', 'M. Editor - Assistant', 'M. Editor - Senior', 'M. CMS Manager',
                'M. Animator (2D)', 'M. Animator - Senior (3D)', 'M. Producer - Post',
                'M. VFX Supervisor', 'M. Post Audio Engineer', 'M. Colorist', 'M. VO Artist',
                'M. Graphic Designer', 'M. Graphic Designer - Senior', 'M. Animation Supervisor',
                'M. Post Production Supervisor', 'M. Post Production Fringe',
                
                // Post Production Expenses
                'N. Music Clearance', 'N. Music Library Fees', 'N. Stock Image Licensing',
                'N. Stock Video Licensing', 'N. Transcriptions and Translations',
                
                // Creative and Strategic Services
                'O. Art Director', 'O. Art Director - Senior', 'O. Copywriter', 'O. Copywriter - Senior',
                'O. Creative Director', 'O. Creative Director - Associate', 'O. Graphic Designer',
                'O. Graphic Designer - Senior', 'O. UI/UX Designer', 'O. Experiential Designer',
                'O. Experiential Producer', 'O. Illustrator', 'O. Strategy - Creative Strategist',
                'O. Strategy - Strategy Director', 'O. Storyboard Artist', 'O. Group Creative Director',
                'O. Creative and Strategic Services Fringe',
                
                // Creative and Strategic Services Expenses
                'P. Airfare', 'P. Hotel', 'P. Per Diems', 'P. Taxi & Rideshare', 'P. Car Rental',
                'P. Catering', 'P. Fabrication', 'P. Furniture and Decor', 'P. Signage and Print',
                'P. Shipping and Postage',
                
                // Account and Project Management
                'Q. Account Manager', 'Q. Account Director', 'Q. Project Manager',
                'Q. Project Manager - Senior', 'Q. Supervising Project Manager',
                
                // Account and Project Management Expenses
                'R. Airfare', 'R. Hotel', 'R. Per Diems', 'R. Taxi & Rideshare', 'R. Car Rental'
            ];

            // Initialize default dates
            const initializeDates = () => {
                const today = new Date();
                const isoDate = today.toISOString().split('T')[0];
                
                document.getElementById('invoice-date').value = isoDate;
                document.getElementById('service-start').value = isoDate;
                document.getElementById('service-end').value = isoDate;
            };

            // Create new item row
            const createItemRow = (copyData = null) => {
                const row = document.createElement('tr');
                row.className = 'table-row';
                
                // Build service options HTML
                const serviceOptionsHTML = serviceOptions.map(service => 
                    `<option value="${service}">${service}</option>`
                ).join('');
                
                row.innerHTML = `
                    <td class="table-cell">
                        <select class="form-select service-item">
                            <option value="" disabled ${!copyData ? 'selected' : ''}>Select a service...</option>
                            ${serviceOptionsHTML}
                        </select>
                    </td>
                    <td class="table-cell">
                        <input type="text" placeholder="######" maxlength="6" 
                               class="table-input job-code" pattern="[0-9]{6}"
                               value="${copyData ? copyData.jobCode : ''}">
                    </td>
                    <td class="table-cell">
                        <input type="number" placeholder="0" min="0" step="0.5" 
                               class="table-input quantity"
                               value="${copyData ? copyData.quantity : '0'}">
                    </td>
                    <td class="table-cell">
                        <input type="number" placeholder="0.00" min="0" step="0.01" 
                               class="table-input rate"
                               value="${copyData ? copyData.rate : ''}">
                    </td>
                    <td class="table-cell amount-cell">$0.00</td>
                    <td class="table-cell no-print">
                        <div class="action-buttons">
                            <button type="button" class="action-btn remove-btn remove-item-btn" title="Remove item">×</button>
                            <button type="button" class="action-btn duplicate-btn duplicate-item-btn" title="Duplicate item">⧉</button>
                        </div>
                    </td>
                `;
                
                // Set selected service if copying
                if (copyData && copyData.service) {
                    row.querySelector('.service-item').value = copyData.service;
                }
                
                // Add event listeners
                const jobCodeInput = row.querySelector('.job-code');
                jobCodeInput.addEventListener('input', (e) => {
                    e.target.value = e.target.value.replace(/[^0-9]/g, '');
                    validateJobCode(e.target);
                });

                const quantityInput = row.querySelector('.quantity');
                const rateInput = row.querySelector('.rate');
                
                quantityInput.addEventListener('input', calculateTotals);
                rateInput.addEventListener('input', calculateTotals);

                itemsContainer.appendChild(row);
                calculateTotals();
                
                return row;
            };

            // Calculate totals
            const calculateTotals = () => {
                let subtotal = 0;
                
                document.querySelectorAll('.table-row').forEach(row => {
                    const quantity = parseFloat(row.querySelector('.quantity').value) || 0;
                    const rate = parseFloat(row.querySelector('.rate').value) || 0;
                    const amount = quantity * rate;
                    
                    row.querySelector('.amount-cell').textContent = `$${amount.toFixed(2)}`;
                    subtotal += amount;
                });

                const taxRate = parseFloat(taxRateEl.value) || 0;
                const taxAmount = subtotal * (taxRate / 100);
                const grandTotal = subtotal + taxAmount;

                subtotalEl.textContent = `$${subtotal.toFixed(2)}`;
                grandTotalEl.textContent = `$${grandTotal.toFixed(2)}`;
            };

            // Validate job code
            const validateJobCode = (input) => {
                const value = input.value;
                if (value.length > 0 && value.length < 6) {
                    input.classList.add('validation-error');
                } else {
                    input.classList.remove('validation-error');
                }
            };

            // Show status message
            const showStatusMessage = (message, type = 'success') => {
                statusMessage.textContent = message;
                statusMessage.className = `status-message status-${type} show`;
                
                setTimeout(() => {
                    statusMessage.classList.remove('show');
                }, 5000);
            };

            // Duplicate row function
            const duplicateRow = (sourceRow) => {
                const data = {
                    service: sourceRow.querySelector('.service-item').value,
                    jobCode: sourceRow.querySelector('.job-code').value,
                    quantity: sourceRow.querySelector('.quantity').value,
                    rate: sourceRow.querySelector('.rate').value
                };
                createItemRow(data);
            };

            // Handle submit
            const handleSubmit = async (e) => {
                e.preventDefault();
                
                submitBtn.disabled = true;
                submitBtn.textContent = 'Submitting...';
                
                const invoiceData = {
                    timestamp: new Date().toISOString(),
                    costCenter: document.getElementById('cost-center').value,
                    vendorName: document.getElementById('vendor-name').value,
                    vendorAddress: document.getElementById('vendor-address').value,
                    vendorCity: document.getElementById('vendor-city').value,
                    vendorEmail: document.getElementById('vendor-email').value,
                    clientName: document.getElementById('client-name').value,
                    hiringManager: document.getElementById('hiring-manager').value,
                    hiringManagerEmail: document.getElementById('hiring-manager-email').value,
                    invoiceNumber: document.getElementById('invoice-number').value,
                    invoiceDate: document.getElementById('invoice-date').value,
                    payTerms: document.getElementById('pay-terms').value,
                    poNumber: document.getElementById('po-number').value || '',
                    serviceStart: document.getElementById('service-start').value,
                    serviceEnd: document.getElementById('service-end').value,
                    subtotal: subtotalEl.textContent,
                    taxRate: taxRateEl.value,
                    grandTotal: grandTotalEl.textContent,
                    items: []
                };

                document.querySelectorAll('.table-row').forEach(row => {
                    const serviceItem = row.querySelector('.service-item').value;
                    if (serviceItem) {
                        invoiceData.items.push({
                            serviceItem: serviceItem,
                            jobCode: row.querySelector('.job-code').value,
                            hours: row.querySelector('.quantity').value,
                            rate: row.querySelector('.rate').value,
                            amount: row.querySelector('.amount-cell').textContent
                        });
                    }
                });

                if (GOOGLE_SCRIPT_URL === 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE') {
                    showStatusMessage('Please configure your Google Apps Script URL', 'error');
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Submit to Spreadsheet';
                    return;
                }

                try {
                    const response = await fetch(GOOGLE_SCRIPT_URL, {
                        method: 'POST',
                        body: JSON.stringify(invoiceData)
                    });
                    
                    showStatusMessage('Data submitted successfully!', 'success');
                } catch (error) {
                    showStatusMessage('Error submitting data. Please try again.', 'error');
                    console.error('Error:', error);
                } finally {
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Submit to Spreadsheet';
                }
            };

            // Event Listeners
            addItemBtn.addEventListener('click', () => createItemRow());
            submitBtn.addEventListener('click', handleSubmit);
            printBtn.addEventListener('click', () => window.print());
            taxRateEl.addEventListener('input', calculateTotals);
            
            // Handle remove and duplicate buttons
            itemsContainer.addEventListener('click', (e) => {
                if (e.target.classList.contains('remove-item-btn')) {
                    e.target.closest('.table-row').remove();
                    calculateTotals();
                    
                    // Always keep at least one row
                    if (itemsContainer.children.length === 0) {
                        createItemRow();
                    }
                } else if (e.target.classList.contains('duplicate-item-btn')) {
                    duplicateRow(e.target.closest('.table-row'));
                }
            });

            // Initialize
            initializeDates();
            createItemRow(); // Create initial row
            calculateTotals();
        });
    </script>
</body>
</html>
